#!/usr/bin/env python
"""A script to setup directory structure for G-TeCS config files."""

import glob
import os
import shutil
import sys
import traceback

from gtecs import params

import pkg_resources


# find package resources
gtecs_data_dir = pkg_resources.resource_filename('gtecs', 'data')
gtecs_html_dir = pkg_resources.resource_filename('gtecs', 'data/html')

print('~~~~~~~~~~~~~~~~~~~~~~')
print('Setting up G-TeCS')
print('~~~~~~~~~~~~~~~~~~~~~~')

# Check config file path
if params.CONFIG_FILE_PATH is None:
    print('ERROR: No config file found, using default config')
    print('       You need to create a .gtecs.conf file')
    sys.exit(1)
print('Using config file {}/.gtecs.conf'.format(params.CONFIG_FILE_PATH))
print('')

# Check config path
config_path = params.CONFIG_PATH
if config_path in ['/config/path/goes/here/', 'config_path_not_set']:
    print('ERROR: CONFIG_PATH not set')
    print('       You need to edit .gtecs.conf')
    sys.exit(1)
print('CONFIG_PATH is set to: "{}"'.format(params.CONFIG_PATH))
print('')

# Create directories
direcs = [params.CONFIG_PATH,
          params.LOG_PATH,
          params.PID_PATH,
          params.IMAGE_PATH,
          ]
try:
    for direc in direcs:
        if not os.path.exists(direc):
            os.mkdir(direc)
        print('Created ', direc)
except Exception:
    print('ERROR: Failed to create config directories')
    print('       Try creating {} yourself then re-running this script'.format(params.CONFIG_PATH))
    traceback.print_exc()
    sys.exit(1)
print('')

# Now copy files there
files = glob.glob(os.path.join(gtecs_data_dir, '*[!.fit]'))
try:
    for data_file in files:
        shutil.copy(data_file, os.path.join(params.CONFIG_PATH, data_file.split('/')[-1]))
        print('Created ', data_file)
except Exception:
    print('ERROR: Failed to copy data files to config directory')
    traceback.print_exc()
    sys.exit(1)
print('')

print('Setup complete!')
