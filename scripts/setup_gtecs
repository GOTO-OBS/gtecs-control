#!/usr/bin/env python
"""A script to setup directory structure for G-TeCS config files."""

import os
import shutil

from gtecs import params

import pkg_resources


# find package resources
gtecs_data_dir = pkg_resources.resource_filename('gtecs', 'data')
gtecs_html_dir = pkg_resources.resource_filename('gtecs', 'data/html')

# create CONFIG_DIR if necessary and put files there
try:
    if not os.path.exists(params.CONFIG_PATH):
        os.mkdir(params.CONFIG_PATH)

    if not os.path.exists(params.IMAGE_PATH):
        os.mkdir(params.IMAGE_PATH)

    if not os.path.exists(params.LOG_PATH):
        os.mkdir(params.LOG_PATH)

    if not os.path.exists(params.QUEUE_PATH):
        os.mkdir(params.QUEUE_PATH)
    for folder in ['todo', 'aborted', 'completed', 'interrupted']:
        folderpath = os.path.join(params.QUEUE_PATH, folder)
        if not os.path.exists(folderpath):
            os.mkdir(folderpath)

    if not os.path.exists(params.PID_PATH):
        os.mkdir(params.PID_PATH)

    htmlpath = os.path.join(params.CONFIG_PATH, 'html')
    if not os.path.exists(htmlpath):
        os.mkdir(htmlpath)

    # now copy data there
    for data_file in ['conditions_flags', 'status_flags',
                      'run_number', 'horizon', 'exposure_queue']:
        shutil.copy(os.path.join(gtecs_data_dir, data_file),
                    os.path.join(params.CONFIG_PATH, data_file))
    for f in os.listdir(gtecs_html_dir):
        shutil.copy(os.path.join(gtecs_html_dir, f),
                    os.path.join(htmlpath, f))

    print('Setup complete!')
    print('CONFIG_PATH is at ', params.CONFIG_PATH)
except Exception:
    print('Failed to set up the CONFIG_PATH ', params.CONFIG_PATH,
          'You should create this directory yourself manually')
