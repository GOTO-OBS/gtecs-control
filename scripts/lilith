#!/usr/bin/env python3
"""A script to provide overall control of the daemons."""

import sys
import time

from gtecs import params
from gtecs.misc import execute_command


if __name__ == '__main__':
    if sys.argv[1] in ['start', 'shutdown', 'kill', 'ping']:
        if len(sys.argv) > 2:
            daemons = sys.argv[2:]
        else:
            daemons = list(params.DAEMONS)

        # remove individual UT interfaces and replace with one command
        if any(interface_id in daemons for interface_id in params.INTERFACES):
            for interface_id in params.INTERFACES:
                if interface_id in daemons:
                    daemons.remove(interface_id)
            daemons.append('intf')

        # handle dependencies
        if 'exq' in daemons:
            # exq needs to start after cam and filt and shutdown first
            if sys.argv[1] == 'start':
                daemons.remove('exq')
                daemons.append('exq')
            elif sys.argv[1] == 'shutdown':
                # move to front
                daemons.remove('exq')
                daemons.insert(0, 'exq')
        if 'intf' in daemons:
            # interfaces need to start before the daemons and shutdown after
            if sys.argv[1] == 'start':
                # move to front
                daemons.remove('intf')
                daemons.insert(0, 'intf')
            elif sys.argv[1] == 'shutdown':
                # move to back
                daemons.remove('intf')
                daemons.append('intf')

        for d in daemons:
            command = '{} {}'.format(d, sys.argv[1])
            execute_command(command)
            time.sleep(1)
    else:
        print('Valid commands: start, shutdown, kill, ping')
